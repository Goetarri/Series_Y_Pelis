<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watchlist</title>
<style>
:root {
  --color-primario: #0077ff;
  --color-borrar: #ff4444;
  --fondo: #f5f5f5;
  --texto: #222;
  --barra-bg: #eee;
  --barra-activo: #0077ff;
  --barra-texto: #fff;
  --barra-inactivo: #aaa;
  --btn-agregar-color: #28a745;
}

body {
  font-family: system-ui, sans-serif;
  background: var(--fondo);
  margin: 0;
  padding: 1rem 0 4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

.header {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  width: 100%;
}

h1 {
  font-size: 1.6rem;
  color: var(--texto);
  text-align: center;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.menu-btn {
  position: absolute;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
}

.menu {
  display: none;
  position: absolute;
  top: 2.5rem;
  right: 0.5rem;
  background: white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  border-radius: 8px;
  overflow: hidden;
  z-index: 1000;
}
.menu.visible { display: block; }
.menu button {
  display: block;
  width: 100%;
  padding: 0.6rem 1rem;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  font-size: 1rem;
}
.menu button:hover { background: #f0f0f0; }

.form {
  background: #fff;
  padding: 1rem;
  border-radius: 12px;
  width: 95%;
  max-width: 600px;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: max-height 0.4s ease, opacity 0.4s ease, margin-bottom 0.4s ease;
  margin-bottom: 1rem;
}
.form.visible { max-height: 500px; opacity: 1; margin-bottom: 2rem; }
.form input, .form select, .form button { font-size:1rem; padding:0.6rem; border-radius:8px; border:1px solid #ccc; width:100%; box-sizing:border-box; }
.form button { background: var(--color-primario); color:#fff; border:none; cursor:pointer; }
.form button:hover { background:#005fcb; }

.filtro { width:95%; max-width:600px; margin-bottom:0.5rem; }
.filtro select { width:100%; padding:0.6rem; border-radius:8px; border:1px solid #ccc; font-size:1rem; }

table { width:95%; max-width:600px; border-collapse:collapse; margin-bottom:1rem; background:white; table-layout:fixed; }
thead { background: var(--color-primario); color:white; }
th, td { padding:0.75rem; text-align:left; word-wrap:break-word; }
tbody tr:nth-child(odd) { background:#f9f9f9; cursor:pointer; }

.delete-btn { background:none; border:none; color:var(--color-borrar); font-size:1.1rem; cursor:pointer; padding:0.2rem 0.4rem; }
.delete-btn:hover { opacity:0.7; }

.barra { position:fixed; bottom:0; left:0; width:100%; display:flex; background: var(--barra-bg); height:3.5rem; box-shadow:0 -2px 6px rgba(0,0,0,0.1); }
.barra button { margin:0; border-radius:0; background: var(--barra-inactivo); color:#fff; border:none; cursor:pointer; height:100%; font-size:1.1rem; font-weight:bold; }
.barra button.activo { background: var(--barra-activo); color: var(--barra-texto); }
#btnSeries { flex:0 0 43%; } #btnPeliculas { flex:0 0 43%; }
#btnAgregarForm { flex:0 0 14%; background:var(--btn-agregar-color); color:#fff; font-weight:bold; font-size:1.5rem; }

#modalSinopsis { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:2000; }
#modalSinopsis .contenido { background:#fff; padding:1rem; border-radius:12px; max-width:90%; max-height:80%; overflow:auto; }
#modalSinopsis button { margin-top:1rem; background:var(--color-primario); color:#fff; border:none; padding:0.5rem 1rem; border-radius:8px; cursor:pointer; }
</style>
</head>
<body>

<div class="header">
  <h1 id="tituloPrincipal"><span id="iconoTitulo">üì∫</span><span id="textoTitulo"> Series</span></h1>
  <button class="menu-btn" id="btnMenu">‚ò∞</button>
  <div class="menu" id="menuOpciones">
    <button id="btnExportar">Exportar CSV</button>
    <button id="btnImportar">Importar CSV</button>
    <input type="file" id="inputImportar" accept=".csv" style="display:none">
  </div>
</div>

<div class="filtro">
  <select id="filtroPlataforma">
    <option value="todas">Todas las plataformas</option>
    <option value="Netflix">Netflix</option>
    <option value="Prime Video">Prime Video</option>
    <option value="HBO Max">HBO Max</option>
    <option value="Disney+">Disney+</option>
    <option value="AppleTV+">AppleTV+</option>
  </select>
</div>

<div class="form" id="formulario">
  <select id="tipo">
    <option value="series" selected>Serie</option>
    <option value="peliculas">Pel√≠cula</option>
  </select>
  <select id="plataforma">
    <option value="Netflix">Netflix</option>
    <option value="Prime Video">Prime Video</option>
    <option value="HBO Max">HBO Max</option>
    <option value="Disney+">Disney+</option>
    <option value="AppleTV+">AppleTV+</option>
  </select>
  <input type="text" id="titulo" placeholder="T√≠tulo">
  <button id="agregar">Agregar</button>
</div>

<table id="tablaSeries">
  <thead><tr><th>T√≠tulo</th><th>Plataforma</th><th>Acci√≥n</th></tr></thead>
  <tbody id="cuerpoSeries"></tbody>
</table>

<table id="tablaPeliculas" style="display:none">
  <thead><tr><th>T√≠tulo</th><th>Plataforma</th><th>Acci√≥n</th></tr></thead>
  <tbody id="cuerpoPeliculas"></tbody>
</table>

<div class="barra">
  <button id="btnSeries" class="activo">Series</button>
  <button id="btnPeliculas">Pelis</button>
  <button id="btnAgregarForm">+</button>
</div>

<div id="modalSinopsis">
  <div class="contenido">
    <div id="textoSinopsis"></div>
    <button id="cerrarModal">Cerrar</button>
  </div>
</div>

<script>
const tipoSelect = document.getElementById('tipo');
const tituloInput = document.getElementById('titulo');
const plataformaSelect = document.getElementById('plataforma');
const agregarBtn = document.getElementById('agregar');
const formulario = document.getElementById('formulario');
const iconoTitulo = document.getElementById('iconoTitulo');
const textoTitulo = document.getElementById('textoTitulo');
const tablaSeries = document.getElementById('tablaSeries');
const tablaPeliculas = document.getElementById('tablaPeliculas');
const cuerpoSeries = document.getElementById('cuerpoSeries');
const cuerpoPeliculas = document.getElementById('cuerpoPeliculas');
const btnSeries = document.getElementById('btnSeries');
const btnPeliculas = document.getElementById('btnPeliculas');
const btnAgregarForm = document.getElementById('btnAgregarForm');
const filtroPlataforma = document.getElementById('filtroPlataforma');
const btnMenu = document.getElementById('btnMenu');
const menuOpciones = document.getElementById('menuOpciones');
const btnExportar = document.getElementById('btnExportar');
const btnImportar = document.getElementById('btnImportar');
const inputImportar = document.getElementById('inputImportar');
const modalSinopsis = document.getElementById('modalSinopsis');
const textoSinopsis = document.getElementById('textoSinopsis');
const cerrarModal = document.getElementById('cerrarModal');

let series = JSON.parse(localStorage.getItem('series')) || [];
let peliculas = JSON.parse(localStorage.getItem('peliculas')) || [];

function guardar() {
  localStorage.setItem('series', JSON.stringify(series));
  localStorage.setItem('peliculas', JSON.stringify(peliculas));
}

function render(lista, cuerpo, tipo) {
  const filtro = filtroPlataforma.value;
  cuerpo.innerHTML = '';
  lista.filter(item => filtro==='todas'||item.plataforma===filtro)
       .forEach((item,index)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${item.titulo}</td><td>${item.plataforma}</td><td><button class="delete-btn">üóëÔ∏è</button></td>`;
    tr.querySelector('.delete-btn').addEventListener('click', e=>{
      e.stopPropagation();
      lista.splice(index,1); guardar(); render(lista,cuerpo,tipo);
    });
    tr.addEventListener('click', ()=>buscarSinopsisTMDb(item.titulo,tipo));
    cuerpo.appendChild(tr);
  });
}

function mostrarLista(tipo){
  if(tipo==='series'){
    tablaSeries.style.display='table'; tablaPeliculas.style.display='none';
    btnSeries.classList.add('activo'); btnPeliculas.classList.remove('activo');
    iconoTitulo.textContent='üì∫'; textoTitulo.textContent=' Series';
  } else {
    tablaSeries.style.display='none'; tablaPeliculas.style.display='table';
    btnPeliculas.classList.add('activo'); btnSeries.classList.remove('activo');
    iconoTitulo.textContent='üéûÔ∏è'; textoTitulo.textContent=' Pel√≠culas';
  }
  aplicarFiltro();
}

function aplicarFiltro(){
  if(tablaSeries.style.display==='table'){ render(series,cuerpoSeries,'series'); }
  else { render(peliculas,cuerpoPeliculas,'peliculas'); }
}

function agregarElemento(){
  const titulo = tituloInput.value.trim();
  const plataforma = plataformaSelect.value;
  const tipo = tipoSelect.value;
  if(!titulo){ alert('Escribe un t√≠tulo'); return; }
  const lista = tipo==='series'?series:peliculas;
  if(!lista.some(e=>e.titulo.toLowerCase()===titulo.toLowerCase())){
    lista.push({titulo,plataforma});
  }
  guardar(); aplicarFiltro(); mostrarLista(tipo);
  tituloInput.value=''; formulario.classList.remove('visible');
}

agregarBtn.addEventListener('click', agregarElemento);
tituloInput.addEventListener('keydown', e=>{ if(e.key==='Enter') agregarElemento(); });
btnSeries.addEventListener('click', ()=>{ mostrarLista('series'); formulario.classList.remove('visible'); });
btnPeliculas.addEventListener('click', ()=>{ mostrarLista('peliculas'); formulario.classList.remove('visible'); });
btnAgregarForm.addEventListener('click', ()=>{ tipoSelect.value=tablaPeliculas.style.display==='table'?'peliculas':'series'; formulario.classList.toggle('visible'); tituloInput.focus(); });
filtroPlataforma.addEventListener('change', aplicarFiltro);

btnMenu.addEventListener('click', ()=>menuOpciones.classList.toggle('visible'));
document.addEventListener('click', e=>{ if(!e.target.closest('.menu')&&!e.target.closest('#btnMenu')) menuOpciones.classList.remove('visible'); });

btnExportar.addEventListener('click', ()=>{
  let csv='Tipo,T√≠tulo,Plataforma\n';
  series.forEach(s=>csv+=`Serie,${s.titulo},${s.plataforma}\n`);
  peliculas.forEach(p=>csv+=`Pel√≠cula,${p.titulo},${p.plataforma}\n`);
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download='watchlist.csv'; a.click(); URL.revokeObjectURL(url); menuOpciones.classList.remove('visible');
});
btnImportar.addEventListener('click', ()=>inputImportar.click());
inputImportar.addEventListener('change', e=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=event=>{
    const lines=event.target.result.split(/\r?\n/);
    lines.slice(1).forEach(line=>{
      const [tipo,titulo,plataforma]=line.split(',');
      if(titulo && plataforma){
        const cleanTitulo=titulo.trim(), cleanPlataforma=plataforma.trim();
        if(tipo==='Serie'){ if(!series.some(s=>s.titulo.toLowerCase()===cleanTitulo.toLowerCase())) series.push({titulo:cleanTitulo,plataforma:cleanPlataforma}); }
        else if(tipo==='Pel√≠cula'){ if(!peliculas.some(p=>p.titulo.toLowerCase()===cleanTitulo.toLowerCase())) peliculas.push({titulo:cleanTitulo,plataforma:cleanPlataforma}); }
      }
    });
    guardar(); aplicarFiltro(); alert('Importaci√≥n completada ‚úÖ');
  };
  reader.readAsText(file); menuOpciones.classList.remove('visible');
});

cerrarModal.addEventListener('click', ()=>modalSinopsis.style.display='none');
modalSinopsis.addEventListener('click', e=>{ if(e.target===modalSinopsis) modalSinopsis.style.display='none'; });

function buscarSinopsisTMDb(titulo,tipo){
  const apiKey='a0080a31ac38a365707cbe63be481cb0'; // Reemplaza con tu clave TMDb
  const tipoEndpoint = tipo==='series'?'tv':'movie';
  const searchUrl = `https://api.themoviedb.org/3/search/${tipoEndpoint}?api_key=${apiKey}&query=${encodeURIComponent(titulo)}&language=es-ES`;
  textoSinopsis.textContent='Cargando...';
  modalSinopsis.style.display='flex';

  fetch(searchUrl)
    .then(r=>r.json())
    .then(data=>{
      if(data.results && data.results.length>0){
        const item=data.results[0];
        const detailUrl = `https://api.themoviedb.org/3/${tipoEndpoint}/${item.id}?api_key=${apiKey}&language=es-ES`;
        return fetch(detailUrl);
      } else throw new Error('No encontrado');
    })
    .then(r2=>r2.json())
    .then(detail=>{
      const posterUrl = detail.poster_path?`https://image.tmdb.org/t/p/w500${detail.poster_path}`:'';
      textoSinopsis.innerHTML = `
        <strong>${detail.name||detail.title}</strong> (${detail.first_air_date?.slice(0,4)||detail.release_date?.slice(0,4)})<br>
        <em>${(detail.genres||[]).map(g=>g.name).join(', ')}</em><br>
        ${posterUrl?`<img src="${posterUrl}" alt="Poster" style="width:100%;max-width:300px;margin-top:0.5rem;">`:''}
        <p>${detail.overview||'Sin sinopsis disponible.'}</p>`;
    })
    .catch(()=>{ textoSinopsis.textContent='Sin sinopsis disponible.'; });
}

aplicarFiltro(); mostrarLista('series');
</script>
</body>
</html>

