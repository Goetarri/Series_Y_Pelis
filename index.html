<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watchlist</title>
<style>
:root {
  --color-primario: #0077ff;
  --color-borrar: #ff4444;
  --fondo: #f5f5f5;
  --texto: #222;
  --barra-bg: #eee;
  --barra-activo: #0077ff;
  --barra-texto: #fff;
  --barra-inactivo: #aaa;
  --btn-agregar-color: #28a745;
}

body {
  font-family: system-ui, sans-serif;
  background: var(--fondo);
  margin: 0;
  padding: 1rem 0 4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 95%;
  max-width: 600px;
  margin-bottom: 0.5rem;
}

h1 {
  font-size: 1.6rem;
  color: var(--texto);
  margin: 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex:1;
  justify-content: center;
}

.menu-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
}

.menu {
  display: none;
  position: absolute;
  top: 2.5rem;
  left: 1rem;
  background: white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  border-radius: 8px;
  overflow: hidden;
  z-index: 1000;
}
.menu.visible { display: block; }
.menu button {
  display: block;
  width: 100%;
  padding: 0.6rem 1rem;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  font-size: 1rem;
}
.menu button:hover { background: #f0f0f0; }

#btnAgregarForm {
  background: var(--fondo);
  color: var(--btn-agregar-color);
  font-weight: bold;
  font-size: 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  padding: 0.2rem 0.6rem;
}

.form {
  background: #fff;
  padding: 1rem;
  border-radius: 12px;
  width: 95%;
  max-width: 600px;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
  visibility: hidden;
  transition: max-height 0.4s ease, opacity 0.4s ease, margin-bottom 0.4s ease;
}
.form.visible {
  max-height: 500px;
  opacity: 1;
  pointer-events: auto;
  visibility: visible;
  margin-bottom: 2rem;
}
.form input, .form select, .form button {
  font-size:1rem; padding:0.6rem; border-radius:8px; border:1px solid #ccc;
  width:100%; box-sizing:border-box;
}
.form button {
  background: var(--color-primario); color:#fff; border:none; cursor:pointer;
}
.form button:hover { background:#005fcb; }

.filtro-container {
  display: flex;
  align-items: center;
  width: 95%;
  max-width: 600px;
  margin: 0.5rem auto 0.5rem auto;
  gap: 0.5rem;
}

.filtro-label {
  font-weight: bold;
  white-space: nowrap;
}

.filtro-select {
  flex: 1;
  padding: 0.6rem;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

table {
  width:95%; max-width:600px; border-collapse:collapse; margin-bottom:1rem; background:white; table-layout:fixed;
}
thead { background: var(--color-primario); color:white; }
th, td { padding:0.75rem; text-align:left; word-wrap:break-word; }
tbody tr:nth-child(odd) { background:#f9f9f9; cursor:pointer; }

.delete-btn {
  background:none; border:none; color:var(--color-borrar);
  font-size:1.1rem; cursor:pointer; padding:0.2rem 0.4rem;
}
.delete-btn:hover { opacity:0.7; }

.barra {
  position:fixed; bottom:0; left:0; width:100%;
  display:flex; background: var(--barra-bg);
  height:3.5rem; box-shadow:0 -2px 6px rgba(0,0,0,0.1);
}
.barra button {
  margin:0; border-radius:0; background: var(--barra-inactivo);
  color:#fff; border:none; cursor:pointer; height:100%;
  font-size:1.2rem; font-weight:bold;
}
.barra button.activo {
  background: var(--barra-activo); color: var(--barra-texto);
}
#btnSeries { flex:0 0 50%; }
#btnPeliculas { flex:0 0 50%; }

#modalSinopsis {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.7); align-items:center; justify-content:center;
  z-index:2000;
}
#modalSinopsis .contenido {
  background:#fff; border-radius:16px; max-width:90%; width:400px;
  max-height:80%; overflow:auto; padding:0; box-shadow:0 4px 12px rgba(0,0,0,0.3);
}
#modalSinopsis .texto { padding:1rem; text-align:center; }
#cerrarModal {
  background: var(--color-primario); color:#fff; border:none;
  padding:0.5rem 1.2rem; border-radius:8px; cursor:pointer;
  margin: 0.8rem auto 1rem auto; display:block; font-weight:bold;
}
</style>
</head>
<body>

<div class="header">
  <button class="menu-btn" id="btnMenu">‚ò∞</button>
  <h1 id="tituloPrincipal">
    <span id="iconoTitulo">üì∫</span><span id="textoTitulo"> Series</span>
  </h1>
  <button id="btnAgregarForm">+</button>

  <div class="menu" id="menuOpciones">
    <button id="btnExportar">Exportar CSV</button>
    <button id="btnImportar">Importar CSV</button>
    <input type="file" id="inputImportar" accept=".csv" style="display:none">
  </div>
</div>

<div class="form" id="formulario">
  <select id="tipo">
    <option value="series" selected>Serie</option>
    <option value="peliculas">Pel√≠cula</option>
  </select>
  <select id="plataforma">
    <option value="Netflix">Netflix</option>
    <option value="Prime Video">Prime Video</option>
    <option value="HBO Max">HBO Max</option>
    <option value="Disney+">Disney+</option>
    <option value="AppleTV+">AppleTV+</option>
  </select>
  <input type="text" id="titulo" placeholder="T√≠tulo">
  <button id="agregar">Agregar</button>
</div>

<div class="filtro-container">
  <label for="filtroPlataforma" class="filtro-label">Filtrar:</label>
  <select id="filtroPlataforma" class="filtro-select">
    <option value="todas">Todas las plataformas</option>
  </select>
</div>

<table id="tablaSeries">
  <thead><tr><th>T√≠tulo</th><th>Plataforma</th><th>Acci√≥n</th></tr></thead>
  <tbody id="cuerpoSeries"></tbody>
</table>

<table id="tablaPeliculas" style="display:none">
  <thead><tr><th>T√≠tulo</th><th>Plataforma</th><th>Acci√≥n</th></tr></thead>
  <tbody id="cuerpoPeliculas"></tbody>
</table>

<div class="barra">
  <button id="btnSeries" class="activo">Series</button>
  <button id="btnPeliculas">Pelis</button>
</div>

<div id="modalSinopsis">
  <div class="contenido">
    <div class="texto" id="textoSinopsis"></div>
    <button id="cerrarModal">Cerrar</button>
  </div>
</div>

<script>
const tipoSelect = document.getElementById('tipo');
const tituloInput = document.getElementById('titulo');
const plataformaSelect = document.getElementById('plataforma');
const agregarBtn = document.getElementById('agregar');
const formulario = document.getElementById('formulario');
const iconoTitulo = document.getElementById('iconoTitulo');
const textoTitulo = document.getElementById('textoTitulo');
const tablaSeries = document.getElementById('tablaSeries');
const tablaPeliculas = document.getElementById('tablaPeliculas');
const cuerpoSeries = document.getElementById('cuerpoSeries');
const cuerpoPeliculas = document.getElementById('cuerpoPeliculas');
const btnSeries = document.getElementById('btnSeries');
const btnPeliculas = document.getElementById('btnPeliculas');
const btnAgregarForm = document.getElementById('btnAgregarForm');
const filtroPlataforma = document.getElementById('filtroPlataforma');

let series = JSON.parse(localStorage.getItem('series')) || [];
let peliculas = JSON.parse(localStorage.getItem('peliculas')) || [];

// Inicializar desplegable Tipo
tipoSelect.value = 'series';

function guardar() {
  localStorage.setItem('series', JSON.stringify(series));
  localStorage.setItem('peliculas', JSON.stringify(peliculas));
}

function render(lista, cuerpo, tipo) {
  const plataformas = Array.from(new Set(lista.map(i => i.plataforma))).sort();
  filtroPlataforma.innerHTML = '<option value="todas">Todas las plataformas</option>';
  plataformas.forEach(p => { filtroPlataforma.innerHTML += `<option value="${p}">${p}</option>`; });

  const filtro = filtroPlataforma.value;
  cuerpo.innerHTML = '';
  lista.filter(item => filtro==='todas'||item.plataforma===filtro)
       .forEach((item,index)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${item.titulo}</td><td>${item.plataforma}</td><td><button class="delete-btn">üóëÔ∏è</button></td>`;
    
    tr.querySelector('.delete-btn').addEventListener('click', e=>{
      e.stopPropagation();
      lista.splice(index,1); guardar(); aplicarFiltro();
    });

    tr.addEventListener('click', () => {
      const API_KEY = 'a0080a31ac38a365707cbe63be481cb0'; // Reemplazar con tu TMDb API key
      const endpoint = tipo==='series' ? 'tv' : 'movie';
      fetch(`https://api.themoviedb.org/3/search/${endpoint}?api_key=${API_KEY}&query=${encodeURIComponent(item.titulo)}`)
        .then(res => res.json())
        .then(data => {
          if(data.results && data.results.length > 0){
            const result = data.results[0];
            document.getElementById('textoSinopsis').innerHTML = `<h3>${result.title || result.name}</h3><p>${result.overview}</p>`;
          } else {
            document.getElementById('textoSinopsis').innerHTML = `<p>No se encontr√≥ sinopsis.</p>`;
          }
          document.getElementById('modalSinopsis').style.display = 'flex';
        })
        .catch(()=> {
          document.getElementById('textoSinopsis').innerHTML = `<p>Error al consultar la API.</p>`;
          document.getElementById('modalSinopsis').style.display = 'flex';
        });
    });

    cuerpo.appendChild(tr);
  });
}

function aplicarFiltro() {
  if(tablaSeries.style.display==='table') render(series,cuerpoSeries,'series');
  else render(peliculas,cuerpoPeliculas,'peliculas');
}

function mostrarLista(tipo) {
  if(tipo==='series'){
    tablaSeries.style.display='table'; tablaPeliculas.style.display='none';
    btnSeries.classList.add('activo'); btnPeliculas.classList.remove('activo');
    iconoTitulo.textContent='üì∫'; textoTitulo.textContent=' Series';
    render(series,cuerpoSeries,'series');
  } else {
    tablaSeries.style.display='none'; tablaPeliculas.style.display='table';
    btnPeliculas.classList.add('activo'); btnSeries.classList.remove('activo');
    iconoTitulo.textContent='üéûÔ∏è'; textoTitulo.textContent=' Pel√≠culas';
    render(peliculas,cuerpoPeliculas,'peliculas');
  }
}

function agregarElemento() {
  const titulo = tituloInput.value.trim();
  const plataforma = plataformaSelect.value;
  const tipo = tipoSelect.value;
  if(!titulo) return;
  const lista = tipo==='series'?series:peliculas;
  if(!lista.some(e=>e.titulo.toLowerCase()===titulo.toLowerCase())){
    lista.push({titulo,plataforma});
  }
  guardar(); mostrarLista(tipo);
  tituloInput.value=''; formulario.classList.remove('visible');
}

agregarBtn.addEventListener('click', agregarElemento);
tituloInput.addEventListener('keydown', e=>{ if(e.key==='Enter') agregarElemento(); });
btnSeries.addEventListener('click', ()=>{ mostrarLista('series'); formulario.classList.remove('visible'); });
btnPeliculas.addEventListener('click', ()=>{ mostrarLista('peliculas'); formulario.classList.remove('visible'); });

// Bot√≥n "+" ajustando Tipo seg√∫n lista activa
btnAgregarForm.addEventListener('click', ()=>{
  formulario.classList.toggle('visible');
  tipoSelect.value = tablaSeries.style.display==='table' ? 'series' : 'peliculas';
  tituloInput.focus();
});

filtroPlataforma.addEventListener('change', aplicarFiltro);

document.getElementById('cerrarModal').addEventListener('click', ()=> {
  document.getElementById('modalSinopsis').style.display='none';
});

// --- Men√∫ CSV ---
const btnMenu = document.getElementById('btnMenu');
const menuOpciones = document.getElementById('menuOpciones');
const btnExportar = document.getElementById('btnExportar');
const btnImportar = document.getElementById('btnImportar');
const inputImportar = document.getElementById('inputImportar');

btnMenu.addEventListener('click', () => menuOpciones.classList.toggle('visible'));

// Exportar ambas listas
btnExportar.addEventListener('click', () => {
  let csv = 'Titulo,Plataforma,Tipo\n';
  series.forEach(e => { csv += `${e.titulo},${e.plataforma},Serie\n`; });
  peliculas.forEach(e => { csv += `${e.titulo},${e.plataforma},Pel√≠cula\n`; });

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'watchlist.csv';
  a.click();
  URL.revokeObjectURL(url);
  menuOpciones.classList.remove('visible');
});

// Importar CSV
btnImportar.addEventListener('click', () => inputImportar.click());
inputImportar.addEventListener('change', e => {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    const lines = ev.target.result.split('\n').slice(1);
    lines.forEach(line => {
      const [titulo, plataforma, tipo] = line.split(',');
      if(!titulo || !plataforma || !tipo) return;
      const lista = tipo.trim().toLowerCase() === 'serie' ? series : peliculas;
      if(!lista.some(e => e.titulo.toLowerCase() === titulo.trim().toLowerCase())){
        lista.push({ titulo: titulo.trim(), plataforma: plataforma.trim() });
      }
    });
    guardar();
    aplicarFiltro();
    inputImportar.value = '';
    menuOpciones.classList.remove('visible');
  };
  reader.readAsText(file);
});

mostrarLista('series');
</script>
</body>
</html>

